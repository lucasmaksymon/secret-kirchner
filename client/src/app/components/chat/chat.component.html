<div class="chat-bubble" [class.minimized]="isMinimized" [class.pinned]="isPinned" [class.embedded]="embedded">
  <!-- BotÃ³n flotante cuando estÃ¡ minimizado -->
  <button 
    *ngIf="isMinimized" 
    class="chat-toggle-btn"
    (click)="toggleMinimize()"
    [attr.aria-label]="'Abrir chat'"
  >
    ğŸ’¬
    <span class="unread-badge" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
  </button>

  <!-- Contenedor del chat -->
  <div class="chat-container card" *ngIf="!isMinimized">
    <div class="chat-header">
      <h4>ğŸ’¬ Chat</h4>
      <div class="chat-controls" *ngIf="!embedded">
        <button 
          class="chat-control-btn"
          (click)="togglePin()"
          [attr.aria-label]="isPinned ? 'Desfijar chat' : 'Fijar chat'"
          [title]="isPinned ? 'Desfijar' : 'Fijar'"
        >
          {{ isPinned ? 'ğŸ“Œ' : 'ğŸ“' }}
        </button>
        <button 
          class="chat-control-btn"
          (click)="toggleMinimize()"
          [attr.aria-label]="'Minimizar chat'"
          title="Minimizar"
        >
          â–
        </button>
      </div>
    </div>

    <div class="chat-messages" #chatMessagesContainer>
      <div 
        *ngFor="let message of chatMessages$ | async"
        class="chat-message"
      >
        <span class="message-author">{{ message.playerName }}:</span>
        <span class="message-text">{{ message.message }}</span>
      </div>
    </div>

    <div class="chat-input">
      <input 
        type="text" 
        [(ngModel)]="newMessage"
        (keypress)="onKeyPress($event)"
        placeholder="EscribÃ­ un mensaje..."
        maxlength="200"
      />
      <button 
        class="btn btn-primary"
        (click)="sendMessage()"
        [disabled]="!newMessage.trim()"
      >
        Enviar
      </button>
    </div>
  </div>
</div>

